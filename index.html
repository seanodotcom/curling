<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Curling Clash!</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,600,0,0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              display: ["Avenir Next", "Futura", "Trebuchet MS", "sans-serif"],
              body: ["Avenir", "Helvetica Neue", "sans-serif"]
            },
            boxShadow: {
              glow: "0 0 40px rgba(20, 94, 145, 0.35)"
            }
          }
        }
      };
    </script>
    <style>
      :root {
        color-scheme: only light;
      }

      html,
      body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        overscroll-behavior: none;
        -webkit-user-select: none;
        user-select: none;
        -webkit-touch-callout: none;
        touch-action: none;
      }

      .glass {
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.78), rgba(255, 255, 255, 0.58));
        backdrop-filter: blur(10px);
      }

      .sweep-pad {
        background-image: repeating-linear-gradient(
          -45deg,
          rgba(30, 136, 229, 0.16) 0,
          rgba(30, 136, 229, 0.16) 8px,
          rgba(255, 255, 255, 0.12) 8px,
          rgba(255, 255, 255, 0.12) 16px
        );
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 999px;
        background: #0ea5e9;
        border: 2px solid white;
        box-shadow: 0 1px 8px rgba(2, 6, 23, 0.35);
      }

      input[type="range"]::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 999px;
        background: #0ea5e9;
        border: 2px solid white;
        box-shadow: 0 1px 8px rgba(2, 6, 23, 0.35);
      }

      .power-meter-slider {
        --thumb-size: 20px;
        --track-size: 8px;
        --power-fill: 65%;
        -webkit-appearance: none;
        appearance: none;
        height: var(--thumb-size);
        padding: 0;
        border-radius: 999px;
        background:
          linear-gradient(90deg, #38bdf8 0%, #22d3ee 42%, #facc15 74%, #f97316 100%) left center / var(--power-fill) var(--track-size) no-repeat,
          linear-gradient(#dbeafe, #dbeafe) left center / 100% var(--track-size) no-repeat;
        transition: box-shadow 120ms ease, filter 120ms ease;
      }

      .power-meter-slider::-webkit-slider-runnable-track {
        height: var(--track-size);
        border-radius: 999px;
        background: transparent;
      }

      .power-meter-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        margin-top: calc((var(--track-size) - var(--thumb-size)) / 2);
      }

      .power-meter-slider::-moz-range-track {
        height: var(--track-size);
        border-radius: 999px;
        background: transparent;
      }

      .flag-wave {
        position: relative;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.2rem 0.45rem;
        border-radius: 999px;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(226, 232, 240, 0.75));
        box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.35), 0 8px 20px rgba(15, 23, 42, 0.16);
      }

      .flag-wave::after {
        content: "";
        position: absolute;
        inset: 0.1rem 0.2rem;
        border-radius: 999px;
        background: linear-gradient(110deg, transparent 0%, rgba(255, 255, 255, 0.45) 45%, transparent 78%);
        opacity: 0;
        pointer-events: none;
      }

      .flag-emoji {
        display: inline-block;
        transform-origin: left center;
        filter: drop-shadow(0 1px 1px rgba(15, 23, 42, 0.3));
      }

      .flag-wave-active .flag-emoji {
        animation: flag-wave 1.1s ease-in-out infinite;
      }

      .flag-wave-active::after {
        opacity: 0.55;
        animation: flag-sheen 1.8s linear infinite;
      }

      .confetti-piece {
        position: absolute;
        top: -18%;
        width: 10px;
        height: 18px;
        border-radius: 2px;
        animation-name: confetti-drop;
        animation-timing-function: linear;
        animation-fill-mode: forwards;
      }

      .material-symbols-rounded {
        font-family: "Material Symbols Rounded";
        font-weight: 600;
        font-style: normal;
        font-size: 16px;
        line-height: 1;
        letter-spacing: normal;
        text-transform: none;
        display: inline-block;
        white-space: nowrap;
        word-wrap: normal;
        direction: ltr;
        -webkit-font-feature-settings: "liga";
        -webkit-font-smoothing: antialiased;
      }

      @keyframes flag-wave {
        0% { transform: perspective(280px) rotateY(0deg) skewY(0deg) scaleX(1) translateY(0); }
        18% { transform: perspective(280px) rotateY(20deg) skewY(1.5deg) scaleX(1.05) translateY(-1px); }
        36% { transform: perspective(280px) rotateY(-10deg) skewY(-1.2deg) scaleX(0.97) translateY(0); }
        54% { transform: perspective(280px) rotateY(16deg) skewY(1.1deg) scaleX(1.03) translateY(-1px); }
        72% { transform: perspective(280px) rotateY(-8deg) skewY(-0.8deg) scaleX(0.98) translateY(0); }
        100% { transform: perspective(280px) rotateY(0deg) skewY(0deg) scaleX(1) translateY(0); }
      }

      @keyframes flag-sheen {
        0% { transform: translateX(-42%); }
        100% { transform: translateX(55%); }
      }

      @keyframes confetti-drop {
        0% { transform: translate3d(0, -15%, 0) rotate(0deg); opacity: 1; }
        80% { opacity: 1; }
        100% { transform: translate3d(var(--dx), 122%, 0) rotate(var(--rot)); opacity: 0; }
      }
    </style>
  </head>
  <body class="min-h-screen bg-[radial-gradient(circle_at_20%_15%,#eff6ff_0%,#dbeafe_22%,#93c5fd_58%,#075985_100%)] font-body text-slate-900">
    <main class="mx-auto flex min-h-screen w-full max-w-6xl items-center justify-center p-2 sm:p-4">
      <section id="game-shell" class="relative w-full max-w-md overflow-hidden rounded-[2rem] border-4 border-slate-100 shadow-glow aspect-[9/16] bg-slate-300">
        <canvas id="game-canvas" class="absolute inset-0 h-full w-full touch-none"></canvas>

        <div class="pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,rgba(255,255,255,.18),rgba(255,255,255,.02))]"></div>

        <header id="hud-overlay" class="pointer-events-none absolute inset-x-0 top-0 z-20 p-3">
          <div class="glass rounded-2xl border border-white/70 p-3">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-[10px] uppercase tracking-[0.15em] text-sky-900/70">End</p>
                <p id="end-label" class="font-display text-lg font-semibold text-sky-950">1 / 5</p>
              </div>
              <div class="text-right">
                <p id="shot-label" class="text-[10px] uppercase tracking-[0.15em] text-sky-900/70">Stone 1 / 32</p>
                <p id="status-label" class="text-sm font-medium text-sky-950">Set your stone position.</p>
              </div>
            </div>
            <div class="mt-3 grid grid-cols-2 gap-2">
              <div id="team0-card" class="rounded-xl bg-rose-100/90 p-2 transition-opacity duration-300">
                <p id="team0-label" class="text-xs font-semibold text-rose-900">üá®üá¶ Canada (P1)</p>
                <div class="mt-0.5 flex items-end justify-between">
                  <p id="score0-label" class="font-display text-2xl leading-none text-rose-700">0</p>
                  <div id="stones0-icons" class="flex gap-1"></div>
                </div>
              </div>
              <div id="team1-card" class="rounded-xl bg-amber-100/90 p-2 text-right transition-opacity duration-300">
                <p id="team1-label" class="text-xs font-semibold text-amber-900">üá∏üá™ Sweden (P2)</p>
                <div class="mt-0.5 flex items-end justify-end gap-2">
                  <div id="stones1-icons" class="flex gap-1"></div>
                  <p id="score1-label" class="font-display text-2xl leading-none text-amber-700">0</p>
                </div>
              </div>
            </div>
            <p id="turn-label" class="mt-2 text-center text-xs font-semibold text-sky-900">Current throw: P1</p>
          </div>
        </header>

        <section id="controls" class="absolute inset-x-0 bottom-0 z-20 p-3">
          <div id="position-controls" class="glass hidden rounded-2xl border border-white/80 p-3">
            <div class="flex items-center justify-between gap-2">
              <p class="text-xs font-semibold uppercase tracking-wider text-sky-900">Starting Position</p>
              <button class="strategy-view-btn hidden inline-flex shrink-0 items-center gap-1 rounded-lg border border-sky-300 bg-white/90 px-2 py-0.5 text-[10px] font-semibold text-sky-900 shadow">
                <span class="strategy-view-icon material-symbols-rounded text-[12px]" aria-hidden="true">visibility</span>
                <span class="strategy-view-label">House</span>
              </button>
            </div>
            <p class="mt-1 text-xs text-slate-700">Slide left/right to pick your hack alignment.</p>
            <input id="position-slider" type="range" min="-1.7" max="1.7" step="0.01" value="0" class="mt-3 h-2 w-full cursor-pointer appearance-none rounded-full bg-sky-200" />
            <button id="lock-position-btn" class="mt-3 w-full rounded-xl bg-sky-700 px-3 py-2 text-sm font-semibold text-white shadow">Lock Position</button>
          </div>

          <div id="power-controls" class="glass hidden rounded-2xl border border-white/80 p-3">
            <div class="flex items-center justify-between gap-2">
              <div class="flex items-center gap-2">
                <button id="power-back-btn" class="inline-flex h-6 w-6 items-center justify-center rounded-md border border-sky-300 bg-white/90 text-sky-900 shadow" aria-label="Back to starting position">
                  <span class="material-symbols-rounded text-[14px]" aria-hidden="true">arrow_back</span>
                </button>
                <p class="text-xs font-semibold uppercase tracking-wider text-sky-900">Power Meter</p>
              </div>
              <button class="strategy-view-btn hidden inline-flex shrink-0 items-center gap-1 rounded-lg border border-sky-300 bg-white/90 px-2 py-0.5 text-[10px] font-semibold text-sky-900 shadow">
                <span class="strategy-view-icon material-symbols-rounded text-[12px]" aria-hidden="true">visibility</span>
                <span class="strategy-view-label">House</span>
              </button>
            </div>
            <p class="mt-1 text-xs text-slate-700">Set release speed, then begin your throw.</p>
            <input id="power-slider" type="range" min="10" max="100" step="1" value="65" class="power-meter-slider mt-3 w-full cursor-pointer rounded-full" />
            <div class="mt-1 flex items-center justify-between text-[10px] font-semibold uppercase tracking-wide">
              <span class="text-sky-700/70">Soft</span>
              <span id="power-readout" class="text-sky-800">65% Normal</span>
              <span class="text-orange-700/75">Hard</span>
            </div>
            <button id="launch-btn" class="mt-3 w-full rounded-xl bg-emerald-600 px-3 py-2 text-sm font-semibold text-white shadow">Next: Curl</button>
          </div>

          <div id="curl-controls" class="glass hidden rounded-2xl border border-white/80 p-3">
            <div class="flex items-center justify-between gap-2">
              <div class="flex items-center gap-2">
                <button id="curl-back-btn" class="inline-flex h-6 w-6 items-center justify-center rounded-md border border-sky-300 bg-white/90 text-sky-900 shadow" aria-label="Back to power setup">
                  <span class="material-symbols-rounded text-[14px]" aria-hidden="true">arrow_back</span>
                </button>
                <p class="text-xs font-semibold uppercase tracking-wider text-sky-900">Curl Control</p>
              </div>
              <button class="strategy-view-btn hidden inline-flex shrink-0 items-center gap-1 rounded-lg border border-sky-300 bg-white/90 px-2 py-0.5 text-[10px] font-semibold text-sky-900 shadow">
                <span class="strategy-view-icon material-symbols-rounded text-[12px]" aria-hidden="true">visibility</span>
                <span class="strategy-view-label">House</span>
              </button>
            </div>
            <p id="curl-help-text" class="mt-1 text-xs text-slate-700">No handle: least predictable path, can drift either way.</p>
            <div class="mt-2 flex items-center justify-between text-[11px] font-semibold text-sky-900">
              <span>CCW</span>
              <span id="curl-value-label">No Handle</span>
              <span>CW</span>
            </div>
            <input id="curl-slider" type="range" min="-3" max="3" step="1" value="0" class="mt-2 h-2 w-full cursor-pointer appearance-none rounded-full bg-gradient-to-r from-sky-300 via-white to-amber-300" />
            <div class="mt-1 flex items-center justify-between px-0.5 text-[10px] font-medium text-slate-500">
              <span>High</span>
              <span>Std</span>
              <span>Low</span>
              <span>0</span>
              <span>Low</span>
              <span>Std</span>
              <span>High</span>
            </div>
            <button id="throw-btn" class="mt-3 w-full rounded-xl bg-sky-800 px-3 py-2 text-sm font-semibold text-white shadow">Throw</button>
          </div>

          <div id="sweep-controls" class="glass hidden rounded-2xl border border-white/80 p-3">
            <p class="text-xs font-semibold uppercase tracking-wider text-sky-900">Sweeping</p>
            <p class="mt-1 text-xs text-slate-700">Swipe fast left/right to reduce friction ahead of your stone.</p>
            <div id="sweep-pad" class="sweep-pad mt-2 h-14 w-full touch-none rounded-xl border border-sky-200"></div>
            <div class="mt-2 h-2 w-full overflow-hidden rounded-full bg-sky-100">
              <div id="sweep-fill" class="h-full w-0 bg-gradient-to-r from-cyan-300 to-cyan-600"></div>
            </div>
          </div>
        </section>

        <button id="fast-forward-btn" class="absolute bottom-3 right-3 z-30 hidden items-center gap-1 rounded-xl border border-emerald-300 bg-emerald-50/95 px-3 py-1.5 text-xs font-bold uppercase tracking-wide text-emerald-900 shadow">
          <span class="material-symbols-rounded" aria-hidden="true">fast_forward</span>
          <span id="fast-forward-label">1X</span>
        </button>

        <button id="sound-toggle-btn" class="absolute right-3 z-30 inline-flex items-center gap-1 rounded-xl border border-sky-300 bg-sky-50/95 px-3 py-1.5 text-xs font-bold uppercase tracking-wide text-sky-900 shadow">
          <span id="sound-toggle-icon" class="material-symbols-rounded" aria-hidden="true">volume_up</span>
          <span id="sound-toggle-label">On</span>
        </button>

        <section id="end-review-panel" class="absolute inset-x-0 bottom-0 z-30 hidden p-3">
          <div class="glass rounded-2xl border border-white/85 p-3">
            <p id="end-review-title" class="text-sm font-bold uppercase tracking-wide text-sky-900">End 1 Complete</p>
            <p id="end-review-body" class="mt-1 text-xs text-slate-700">No scoring stones.</p>
            <div id="end-review-graphic" class="mt-2 flex flex-wrap items-center gap-2"></div>
            <button id="next-round-btn" class="mt-3 w-full rounded-xl bg-sky-800 px-3 py-2 text-sm font-semibold text-white shadow">
              Next Round
            </button>
          </div>
        </section>

        <section id="game-over-overlay" class="absolute inset-0 z-50 hidden items-center justify-center bg-sky-950/60 p-4">
          <div id="game-over-confetti" class="pointer-events-none absolute inset-0 overflow-hidden"></div>
          <div class="relative w-full max-w-sm rounded-3xl border border-white/75 bg-white p-5 text-center shadow-2xl">
            <p class="text-xs font-semibold uppercase tracking-[0.2em] text-sky-700">Game Over</p>
            <div class="mt-3">
              <span id="game-over-flag" class="flag-wave flag-wave-active text-6xl leading-none"><span class="flag-emoji">üèÜ</span></span>
            </div>
            <p id="game-over-title" class="mt-3 font-display text-2xl font-bold text-sky-950">Winner</p>
            <p id="game-over-score" class="mt-2 font-display text-5xl font-bold leading-none text-sky-900">0 - 0</p>
            <p id="game-over-detail" class="mt-2 text-sm text-slate-700">Final score</p>
            <button id="game-over-new-game-btn" class="mt-5 w-full rounded-xl bg-sky-800 px-3 py-3 text-sm font-semibold text-white shadow">
              New Game
            </button>
          </div>
        </section>

        <div id="new-game-overlay" class="absolute inset-0 z-40 flex items-center justify-center bg-sky-950/60 p-4">
          <form id="new-game-form" class="w-full max-w-sm rounded-3xl border border-white/60 bg-white p-5 shadow-2xl">
            <h1 class="font-display text-2xl font-bold text-sky-950">
              Curling Clash! <span class="align-middle text-xs font-semibold text-slate-400">v0.2.3</span>
            </h1>

            <div class="mt-4">
              <p class="text-xs font-semibold uppercase tracking-wider text-slate-600">Mode</p>
              <div class="mt-2 grid grid-cols-2 gap-2">
                <button type="button" data-mode="1p" class="mode-btn rounded-xl border border-sky-300 bg-sky-700 px-3 py-2 text-sm font-semibold text-white">1P vs AI</button>
                <button type="button" data-mode="2p" class="mode-btn rounded-xl border border-sky-300 bg-white px-3 py-2 text-sm font-semibold text-sky-900">2 Player</button>
              </div>
            </div>

            <div class="mt-4 grid grid-cols-2 gap-2">
              <label class="text-sm font-semibold text-slate-700">
                <span class="text-[11px] uppercase tracking-wide text-rose-700">P1 (Red)</span>
                <select id="team0-select" class="mt-1 w-full rounded-xl border border-sky-200 bg-sky-50 px-3 py-2 text-sm"></select>
              </label>
              <label class="text-sm font-semibold text-slate-700">
                <span id="team1-label-inline" class="text-[11px] uppercase tracking-wide text-amber-700">AI Team (Yellow)</span>
                <select id="team1-select" class="mt-1 w-full rounded-xl border border-sky-200 bg-sky-50 px-3 py-2 text-sm"></select>
              </label>
            </div>

            <div class="mt-4">
              <p class="text-xs font-semibold uppercase tracking-wider text-slate-600">Rounds</p>
              <div class="mt-2 grid grid-cols-4 gap-2">
                <button type="button" data-ends="1" class="ends-btn rounded-xl border border-sky-300 bg-white px-3 py-2 text-sm font-semibold text-sky-900">1</button>
                <button type="button" data-ends="3" class="ends-btn rounded-xl border border-sky-300 bg-white px-3 py-2 text-sm font-semibold text-sky-900">3</button>
                <button type="button" data-ends="5" class="ends-btn rounded-xl border border-sky-300 bg-sky-700 px-3 py-2 text-sm font-semibold text-white">5</button>
                <button type="button" data-ends="10" class="ends-btn rounded-xl border border-sky-300 bg-white px-3 py-2 text-sm font-semibold text-sky-900">10</button>
              </div>
            </div>

            <div class="mt-4">
              <p class="text-xs font-semibold uppercase tracking-wider text-slate-600">Stones / Team</p>
              <div class="mt-2 grid grid-cols-4 gap-2">
                <button type="button" data-stones="1" class="stones-btn rounded-xl border border-sky-300 bg-white px-3 py-2 text-sm font-semibold text-sky-900">1</button>
                <button type="button" data-stones="4" class="stones-btn rounded-xl border border-sky-300 bg-white px-3 py-2 text-sm font-semibold text-sky-900">4</button>
                <button type="button" data-stones="8" class="stones-btn rounded-xl border border-sky-300 bg-white px-3 py-2 text-sm font-semibold text-sky-900">8</button>
                <button type="button" data-stones="16" class="stones-btn rounded-xl border border-sky-300 bg-sky-700 px-3 py-2 text-sm font-semibold text-white">16</button>
              </div>
            </div>

            <button type="submit" class="mt-5 w-full rounded-xl bg-sky-800 px-4 py-3 text-sm font-semibold text-white">Start Match</button>
          </form>
        </div>

        <div id="message-overlay" class="pointer-events-none absolute inset-0 z-30 hidden items-center justify-center bg-sky-950/35 p-4">
          <div class="glass rounded-2xl border border-white/70 p-4 text-center">
            <p id="message-title" class="font-display text-xl font-semibold text-sky-950">End Complete</p>
            <p id="message-body" class="mt-1 text-sm text-slate-700"></p>
          </div>
        </div>
      </section>
    </main>

    <script type="module" src="./src/main.js"></script>
  </body>
</html>
